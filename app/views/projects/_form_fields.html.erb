<div class="form-inputs">
  <div class="row well">
    <div class="well col-md-12">
      <%= content_tag :h1, Project.model_name.human, class: 'form-subtitle' %>
      <%= show_simple_base_errors(f) %>
      <div class="row">
        <div class="logo_block col-md-2">
          <%= f.simple_fields_for :logo, (f.object.logo || f.object.build_logo) do |f_logo|  %>
              <%= show_simple_base_errors(f_logo) %>
              <div class="logo-fields col-md-12">
                <div class="">
                  <%= content_tag :div, image_tag(f_logo.object.file.url(:small), height: '210', width: '210'), class: 'logo-img' %>
                  <%= f_logo.input :file, as: :file, label: false, wrapper_html: { class: '' } %>
                  <%= f_logo.input :link_type_id, as: :hidden, input_html: { value: LinkType.logo.take.id } %>
                </div> <!-- logo-fields -->
              </div>
          <% end %>
        </div> <!-- logo_block -->
        <div class="col-md-10">
          <%= f.input :project_type_id, as: :hidden %>
          <%= f.input :name %>
          <%= f.input :description %>
          <%= f.input :comments %>
        </div>
      </div>
      <% if can? :update_checks, Project  %>
        <div class="row">
          <p>
            <%= f.input :active, wrapper_html: { class: 'col-md-2' } unless f.object.new_record? %>
            <%= f.input :volunteers_allowed, wrapper_html: { class: 'col-md-3' } %>
            <%= f.input :publish, wrapper_html: { class: 'col-md-2' } %>
            <%= f.input :outstanding, wrapper_html: { class: 'col-md-2' } %>
            <%= f.input :urgent, wrapper_html: { class: 'col-md-2' } %>
          </p>
        </div>
      <% end %>
    </div>
  </div>
  <div class="row well row-2">
    <%= content_tag :h1, Volunteer.model_name.human(count: 2), class: 'form-subtitle' %>
    <div class="col-md-6">
      <%= f.input :volunteers_num, as: :string, placeholder: '0', input_html: {class: 'm-width150', min: 0, max: 5} %>
      <%= f.input :participants_num, as: :string, placeholder: '0', input_html: {class: 'm-width150', min: 0, max: 5} %>
      <%= f.input :beneficiaries_num, as: :string, placeholder: '0', input_html: {class: 'm-width150', min: 0, max: 5} %>
    </div>
    <div class="col-md-6">
      <%= f.input :functions, as: :text %>
    </div>
  </div>
  <div class="row well row-2">
    <%= content_tag :h1, t('contact_person'), class: 'form-subtitle' %>
    <div class="col-md-6">
      <%= f.input :contact_name %>
      <%= f.input :contact_last_name %>
      <%= f.input :contact_last_name_alt %>
    </div>
    <div class="col-md-6">
      <%= f.input :email, placeholder: 'email@email.com', input_html: {class: 'm-width250'} %>
      <%= f.input :phone_number, input_html: { class: 'm-width150', data: { mask: '999999999'} }  %>
      <%= f.association :entity, input_html: { class: 'm-width200' } %>
    </div>
  </div>
  <div class="row well row-3">
      <%= content_tag :h1, 'Fechas de ejecuciÃ³n', class: 'form-subtitle' %>
      <%= f.input :execution_start_date, as: :string, input_html: date_input_html_default_values(f.object.execution_start_date), wrapper_html: { class: 'col-md-6' } %>
      <%= f.input :execution_end_date, as: :string, input_html: date_input_html_default_values(f.object.execution_end_date), wrapper_html: { class: 'col-md-6' } %>
  </div>
  <div class="row well row-3">
    <%= content_tag :h1, 'Datos del seguro', class: 'form-subtitle' %>
      <%= f.input :insured, wrapper_html: { class: 'col-md-6' } %>
      <%= f.input :insurance_date, as: :string, input_html: date_input_html(f.object.insurance_date), wrapper_html: { class: 'col-md-6' } %>
      <%= f.simple_fields_for :documents do |f_document|  %>
          <%= f_document.input :name, label: Document.model_name.human %>
      <% end %>
  </div>
  <div class="events-block row row-4 well">
    <%= content_tag :h1, "#{Address.model_name.human(count: 2)} #{t('and')} #{Timetable.model_name.human(count: 2)}", class: 'form-subtitle' %>

      <input type="hidden" value="<%= f.object.events.count %>" id="eventsNum" />
      <%= f.simple_fields_for :events, (f.object.events.build if f.object.events.empty?) do |f_event|  %>
        <div class="event-fields well col-md-12">
        <%= content_tag :h2, "#{Address.model_name.human} #{t('and')} #{Timetable.model_name.human(count: 2)}", class: 'form-subtitle' %>

          <div class="row well">
            <%= content_tag :h3, Address.model_name.human, class: 'form-subtitle' %>
            <%= f_event.simple_fields_for :address, (f_event.object.address.presence || f_event.object.build_address) do |f_address|  %>
                <%= render partial: 'addresses/form_fields', locals: {f: f_address } %>
            <% end %>
          </div>

          <div class="timetables_block row well">
            <%= content_tag :h3, Timetable.model_name.human(count: 2), class: 'form-subtitle' %>
              <%= f_event.error :base, class: 'alert alert-danger alert-dismissable' %>
              <%= f_event.simple_fields_for :timetables, (f_event.object.timetables.build if f_event.object.new_record? && f_event.object.timetables.empty?) do |f_timetable|  %>
                <div class="timetable-fields well-no-border col-md-12">
                  <div class="row">
                      <%= f_timetable.input :execution_date, as: :string, input_html: date_input_html_default_values(f_timetable.object.execution_date), wrapper_html: { class: 'col-md-4' } %>
                      <%= f_timetable.input :start_hour, input_html: { class: 'm-width70', data: { mask: '99:99'} }, wrapper_html: { class: 'col-md-4' } %>
                      <%= f_timetable.input :end_hour, input_html: { class: 'm-width70', data: { mask: '99:99'} }, wrapper_html: { class: 'col-md-4' } %>
                      <%= f_timetable.link_to_remove build_icon('trash-o', text: "#{Timetable.model_name.human}"), class: 'pull-right' %>
                  </div> <!-- timetable-fields -->
                </div>
              <% end %>
            <p><%= f_event.link_to_add icon_new(text: "#{Timetable.model_name.human}"), :timetables, class: 'btn' %></p>
          </div> <!-- timetables_block -->

          <p><%= f_event.link_to_remove build_icon('trash-o', text: "#{t('action.remove')} #{Address.model_name.human} #{t('and')} #{Timetable.model_name.human(count: 2)}"), class: 'pull-right', id: 'rmEvent', onclick: 'rmEvent();' %></p>
        </div> <!-- event-fields -->
      <% end %>
    <p><%= f.link_to_add icon_new(text: "#{t('action.add')} #{Address.model_name.human} #{t('and')} #{Timetable.model_name.human(count: 2)}"), :events, class: 'btn', id: 'addEvent', onclick: 'addEvent();' %></p>

  </div> <!-- events-block -->

  <div class="row">
    <div class="well col-md-12">
      <%= content_tag :h3, Area.model_name.human(count: 2), class: 'form-subtitle' %>
      <%= f.association :areas, as: :check_boxes, label: false, item_wrapper_class: 'checkbox-inline checkbox-custom' %>
      <div class='col-sm-12'>
        <% f.object.inactive_areas.each do |area| %>
          <span class='checkbox-inline checkbox-custom'>
            <%= check_box_tag(area.name, value = "1", checked = true, options = { :disabled => true }) %>
            <label style='font-weight: normal;'>
              <%= area.name %>
            </label>
          </span>
        <% end %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="well col-md-12">
      <%= content_tag :h3, Collective.model_name.human(count: 2), class: 'form-subtitle' %>
      <%= f.association :collectives, as: :check_boxes, label: false, item_wrapper_class: 'checkbox-inline checkbox-custom' %>
      <div class='col-sm-12'>
        <% f.object.inactive_collectives.each do |collective| %>
          <span class='checkbox-inline checkbox-custom'>
            <%= check_box_tag(collective.name, value = "1", checked = true, options = { :disabled => true }) %>
            <label style='font-weight: normal;'>
              <%= collective.name %>
            </label>
          </span>
        <% end %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="well col-md-12">
      <%= content_tag :h3, Coordination.model_name.human(count: 2), class: 'form-subtitle' %>
      <%= f.association :coordinations, as: :check_boxes, label: false, item_wrapper_class: 'checkbox-inline checkbox-custom' %>
      <div class='col-sm-12'>
        <% f.object.inactive_coordinations.each do |coordination| %>
          <span class='checkbox-inline checkbox-custom'>
            <%= check_box_tag(coordination.name, value = "1", checked = true, options = { :disabled => true }) %>
            <label style='font-weight: normal;'>
              <%= coordination.name %>
            </label>
          </span>
        <% end %>
      </div>
    </div>
  </div>
  <div id="files" class="row well">
    <div class="files-header row">
      <div class="col-md-11">
        <%= content_tag :h2, "#{t('files')} #{t('and')} #{t('urls')}", class: 'form-subtitle' %>
        <%= content_tag :div, (content_tag :p, t('files_are_allowed_olny_on_update')), class: 'well-no-border' if f.object.new_record? %>
      </div>
      <div class="col-md-1">
        <p class="js-arrow hidden">
          <span><%= build_icon('angle-down') %></span>
          <span class="hidden"><%= build_icon('angle-up') %></span>
        </p>
      </div>
    </div>
    <% if f.object.persisted? %>
      <div class="files-block">
        <div class="images_block row well js-files-block">
          <%= content_tag :h3, t('images'), class: 'form-subtitle' %>
          <div class="col-md-12">
            <% if f.object.images.exists? %>
                <%= f.simple_fields_for :images  do |f_file|  %>
                    <%= show_simple_base_errors(f_file) %>
                    <div class="image-fields well-no-border js-file-fields">
                      <div class="row">
                        <%= f_file.input :path, label: t('name'), input_html: { disabled: true, value: f_file.object.file_name }, wrapper_html: { class: 'link-path col-md-9' } %>
                        <%= f_file.input :link_type_id, as: :hidden, input_html: { value: LinkType.image.take.id } %>
                        <%= content_tag :div, class: 'js-file-link form-group col-md-3' do %>
                            <%= link_to(build_icon(:share), f_file.object.file.url, target: :_blank) %>
                            <%= link_to_show(f_file.object) %>
                            <%= f_file.link_to_remove build_icon('trash-o'), data: { confirm: t('messages.confirm_file_deletion') } %>
                        <% end %>
                      </div> <!-- images-fields -->
                    </div>
                <% end %>
            <% else %>
                <%= content_tag :p, "No tiene #{Project.human_attribute_name(:images)}" %>
            <% end %>
          </div>
          <div class="col-md-12 js-links-block">
            <%= link_to "#{build_icon(:upload, title: "ir a images")} Subir nuevas imÃ¡genes".html_safe,
                        links_path(linkable_id: f.object.id, linkable_type: f.object.class.name, link_type_id: LinkType.image.take.id),
                        target: :_blank,
                        class: 'btn btn-success'%>
          </div>
      </div> <!-- images_block -->
      <div class="docs_block row well js-files-block">
        <%= content_tag :h3, t('docs'), class: 'form-subtitle' %>
          <div class="col-md-12">
          <% if f.object.docs.exists? %>
              <%= f.simple_fields_for :docs  do |f_file|  %>
                  <%= show_simple_base_errors(f_file) %>
                  <div class="doc-fields well-no-border js-file-fields">
                    <div class="row">
                      <%= f_file.input :path, label: t('name'), input_html: { disabled: true, value: f_file.object.file_name }, wrapper_html: { class: 'link-path col-md-9' } %>
                      <%= f_file.input :link_type_id, as: :hidden, input_html: { value: LinkType.document.take.id } %>
                      <%= content_tag :div, class: 'js-file-link form-group col-md-3' do %>
                          <%= link_to(build_icon(:share), f_file.object.file.url, target: :_blank) %>
                          <%= link_to_show(f_file.object) %>
                          <%= f_file.link_to_remove build_icon('trash-o'), data: { confirm: t('messages.confirm_file_deletion') } %>
                      <% end %>
                    </div> <!-- docs-fields -->
                  </div>
              <% end %>
          <% else %>
              <%= content_tag :p, "No tiene #{Project.human_attribute_name(:docs)}" %>
          <% end %>
        </div>
        <div class="col-md-12 js-links-block">
          <%= link_to "#{build_icon(:upload, title: "ir a documentos")} Subir nuevos documentos".html_safe,
                      links_path(linkable_id: f.object.id, linkable_type: f.object.class.name, link_type_id: LinkType.document.take.id),
                      target: :_blank,
                      class: 'btn btn-success' %>
        </div>
      </div> <!-- docs_block -->
      <div class="urls_block row well js-files-block">
        <%= content_tag :h3, t('urls'), class: 'form-subtitle' %>
        <%= f.simple_fields_for :urls  do |f_file|  %>
            <%= show_simple_base_errors(f_file) %>
            <div class="url-fields well-no-border col-md-12 js-file-fields">
              <div class="row">
                <%= f_file.input :path, as: :url, wrapper_html: { class: 'link-path col-md-9' } %>
                <%= f_file.input :link_type_id, as: :hidden, input_html: { value: LinkType.url.take.id } %>
                <%= content_tag :div, class: 'js-file-link form-group col-md-3' do %>
                    <%= link_to(build_icon(:share), f_file.object.path, target: :_blank, class: 'js-visit') %>
                    <%= f_file.link_to_remove build_icon('trash-o'), data: { confirm: t('messages.confirm_file_deletion') } %>
                <% end %>
              </div> <!-- urls-fields -->
            </div>
        <% end %>
        <p><%= f.link_to_add icon_new(text: t('urls')), :urls, class: 'btn' %></p>
      </div> <!-- urls_block -->
    </div>
    <% end %>
  </div>
</div>

<script>



// Preventing destroy events when only one
    var eventsNum = $("#eventsNum").val();

    if (eventsNum < 2) {
      $("#rmEvent").hide();
    }

    function addEvent() {
      eventsNum++;
      $("#rmEvent").show();
    }

    function rmEvent() {
      eventsNum--;
      if (eventsNum < 2) {
        $("#rmEvent").hide();
      }
    }

</script>
